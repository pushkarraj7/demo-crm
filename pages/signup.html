<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up - CRM</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../assets/css/signup.css" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  </head>

  <body>
    <div class="signup-container">
      <!-- Signup Form -->
      <div class="signup-form">
        <div class="form-box">
          <div class="logo">
            <img
              src="../assets/img/axismobi/photos/logo.png"
              alt="Axismobi Logo"
            />
          </div>
          <div class="form-title">Sign Up to Continue...</div>

          <!-- Social buttons in same row -->
          <!-- <div class="button-row">
          <button type="button" id="sign-up-google" class="login-signup-oauth-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="21" height="22" viewBox="0 0 21 22" fill="none">
              <g clip-path="url(#clip0_208_1790)">
                <path
                  d="M10.5 8.67798V12.7443H16.1509C15.9028 14.0521 15.1581 15.1594 14.0413 15.9039L17.449 18.548C19.4345 16.7154 20.5799 14.0235 20.5799 10.8258C20.5799 10.0813 20.5131 9.3653 20.389 8.67809L10.5 8.67798Z"
                  fill="#4285F4"></path>
                <path
                  d="M4.61504 12.5857L3.84648 13.174L1.12598 15.2931C2.8537 18.7199 6.3948 21.0872 10.4993 21.0872C13.3342 21.0872 15.711 20.1517 17.4483 18.5481L14.0406 15.904C13.1052 16.534 11.912 16.9159 10.4993 16.9159C7.76933 16.9159 5.44985 15.0736 4.61934 12.5918L4.61504 12.5857Z"
                  fill="#34A853"></path>
                <path
                  d="M1.12628 5.88123C0.410412 7.29389 0 8.88801 0 10.5871C0 12.2861 0.410412 13.8803 1.12628 15.2929C1.12628 15.3024 4.61998 12.582 4.61998 12.582C4.40998 11.952 4.28585 11.2839 4.28585 10.587C4.28585 9.89005 4.40998 9.22191 4.61998 8.59192L1.12628 5.88123Z"
                  fill="#FBBC05"></path>
                <path
                  d="M10.4995 4.26806C12.0459 4.26806 13.4204 4.8026 14.5182 5.83352L17.525 2.82674C15.7018 1.12768 13.3346 0.0871582 10.4995 0.0871582C6.39502 0.0871582 2.8537 2.44488 1.12598 5.88126L4.61957 8.59217C5.44997 6.11032 7.76954 4.26806 10.4995 4.26806Z"
                  fill="#EA4335"></path>
              </g>
              <defs>
                <clipPath id="clip0_208_1790">
                  <rect width="21" height="21" fill="white" transform="translate(0 0.0871582)"></rect>
                </clipPath>
              </defs>
            </svg>
            <span class="login-signup-oauth-button-label">Google</span>
          </button>
          <button type="button" id="sign-up-microsoft" class="login-signup-oauth-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="21" height="22" viewBox="0 0 21 22" fill="none">
              <path d="M0 0.0871582H9.94737V10.0345H0V0.0871582Z" fill="#F54F0D"></path>
              <path d="M0 11.1398H9.94737V21.0872H0V11.1398Z" fill="#00A2F2"></path>
              <path d="M11.0526 0.0871582H21V10.0345H11.0526V0.0871582Z" fill="#7DBC00"></path>
              <path d="M11.0526 11.1398H21V21.0872H11.0526V11.1398Z" fill="#FFBA00"></path>
            </svg>
            </svg>
            <span class="login-signup-oauth-button-label">Microsoft</span>
          </button>
        </div> -->
          <!-- <div class="or">OR</div> -->

          <form id="signup-form">
            <!-- Name + Phone -->
            <div class="input-row">
              <div class="input-box">
                <input
                  type="text"
                  id="full-name"
                  placeholder="Full Name"
                  required
                />
              </div>
              <div class="input-box">
                <input
                  type="tel"
                  id="phone-number"
                  placeholder="Phone Number"
                  required
                />
              </div>
            </div>

            <!-- Email + Password -->
            <div class="input-row">
              <div class="input-box">
                <input
                  type="email"
                  id="email-input"
                  placeholder="Email Address"
                  required
                />
                <div id="error-message" class="error-message"></div>
              </div>
              <div class="input-box">
                <input
                  type="password"
                  id="password"
                  placeholder="Password"
                  required
                />
              </div>
            </div>

            <!--Country + Company Name-->
            <div class="input-row">
              <div class="input-box">
                <select id="country" class="choices-select" required>
                  <option value="">Select Country</option>
                </select>
              </div>

              <div class="input-box">
                <input
                  type="text"
                  id="company-name"
                  placeholder="Company Name"
                  required
                />
              </div>
            </div>

            <!-- Company Address -->
            <div class="input-box">
              <textarea
                id="company-address"
                rows="2"
                placeholder="Company Address"
                required
              ></textarea>
            </div>

            <div class="terms">
              By signing up, I accept the Axismobi
              <a href="#">Terms of Service</a> and acknowledge the
              <a href="#">Privacy Policy</a>.
            </div>

            <button type="submit" class="signup-btn">Sign Up</button>
          </form>
        </div>
      </div>

      <!--Feature Section-->
      <div class="features-section"></div>
    </div>

    <script src="../assets/js/country-list.js"></script>

    <script>
      document
        .getElementById("signup-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const fullName = document.getElementById("full-name").value.trim();
          const phone = document.getElementById("phone-number").value.trim();
          const email = document.getElementById("email-input").value.trim();
          const password = document.getElementById("password").value.trim();
          const country = document.getElementById("country").value.trim();
          const companyName = document
            .getElementById("company-name")
            .value.trim();
          const companyAddress = document
            .getElementById("company-address")
            .value.trim();
          const errorDiv = document.getElementById("error-message");

          errorDiv.style.display = "none";
          errorDiv.textContent = "";

          if (
            !fullName ||
            !phone ||
            !email ||
            !password ||
            !companyName ||
            !companyAddress
          ) {
            errorDiv.textContent = "Please fill in all fields.";
            errorDiv.style.display = "block";
            return;
          }

          const isValidEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
          if (!isValidEmail) {
            errorDiv.textContent = "Please enter a valid email address.";
            errorDiv.style.display = "block";
            return;
          }

          if (!country) {
            errorDiv.textContent = "Please select a country.";
            errorDiv.style.display = "block";
            return;
          }

          // Store in sessionStorage
          const formData = {
            fullName,
            phone,
            email,
            password,
            country,
            companyName,
            companyAddress,
          };
          sessionStorage.setItem("signupFormData", JSON.stringify(formData));

          // Submit to backend PHP
          fetch("signup_handler.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => response.text())
            .then((data) => {
              if (data === "success") {
                window.location.href = "review.html"; // redirect after success
              } else {
                errorDiv.textContent = data;
                errorDiv.style.display = "block";
              }
            })
            .catch((err) => {
              console.error(err);
              errorDiv.textContent = "An error occurred. Please try again.";
              errorDiv.style.display = "block";
            });
        });
    </script>

    <!--Fetch Features-->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const featuresSection = document.querySelector(".features-section");

        const selected =
          JSON.parse(sessionStorage.getItem("selectedFeatures")) || [];
        const selectedTabId = sessionStorage.getItem("selectedTabId");

        const tabTitleMap = {
          crm: "HR Dashboard",
          marketing: "Finance Dashboard",
          support: "Real Estate Management System",
        };

        const iconMap = {
          attendance: "fa-solid fa-user-check",
          "projects & tasks": "fa-solid fa-tasks",
          "onboard employee": "fa-solid fa-user-plus",
          newsletter: "fa-solid fa-envelope-open-text",
          "weekly performance": "fa-solid fa-chart-line",
          "location & camera login": "fa-solid fa-map-marker-alt",
          "employee review": "fa-solid fa-star-half-alt",
          logs: "fa-solid fa-history",
          "shift incharge checklist": "fa-solid fa-clipboard-check",
          "courses & test": "fa-solid fa-book-reader",
          "onboard vendor": "fa-solid fa-user-tie",
          "purchase order": "fa-solid fa-file-signature",
          "performa invoice": "fa-solid fa-file-invoice-dollar",
          "add invoice": "fa-solid fa-file-invoice",
          "todo list": "fa-solid fa-list-check",
          "multi-organization support": "fa-solid fa-sitemap",
          "onboard occupant/tenant": "fa-solid fa-users",
          "users with custom roles": "fa-solid fa-user-shield",
          "visitor management": "fa-solid fa-id-badge",
          "ticket management": "fa-solid fa-ticket-alt",
          "onboard technician": "fa-solid fa-user-cog",
          "helpdesk info": "fa-solid fa-info-circle",
          "community center": "fa-solid fa-users-cog",
          "billing & invoice": "fa-solid fa-file-invoice-dollar",
          "work permit": "fa-solid fa-clipboard-check",
          gatepass: "fa-solid fa-door-open",
        };

        if (selectedTabId) {
          const tabHeading = document.createElement("h2");
          tabHeading.textContent =
            tabTitleMap[selectedTabId] || "Selected Dashboard";
          tabHeading.style.marginBottom = "16px";
          tabHeading.style.color = "#f55925";
          tabHeading.style.fontWeight = "700";
          tabHeading.style.fontSize = "20px";
          featuresSection.appendChild(tabHeading);
        }

        if (selected.length > 0) {
          const title = document.createElement("h3");
          title.textContent = "Selected Features";
          title.style.marginBottom = "12px";
          title.style.fontWeight = "600";
          featuresSection.appendChild(title);

          selected.forEach((featureRaw) => {
            const feature = featureRaw.replace(/\n/g, " ").trim().toLowerCase();

            const card = document.createElement("div");
            card.className = "feature-card";
            card.style.display = "flex";
            card.style.alignItems = "center";
            card.style.marginBottom = "10px";

            const iconClass = iconMap[feature] || "fa-solid fa-square";
            const iconEl = document.createElement("i");
            iconEl.className = iconClass;
            iconEl.style.marginRight = "10px";
            iconEl.style.fontSize = "18px";
            iconEl.style.color = "#f55925";

            const text = document.createElement("span");
            text.textContent = featureRaw.trim();

            card.appendChild(iconEl);
            card.appendChild(text);
            featuresSection.appendChild(card);
          });
        }
      });
    </script>

    <!--Country List-->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const countrySelect = document.getElementById("country");

        // Clear old options (except placeholder)
        countrySelect.innerHTML = `<option value=""> Select Country</option>`;

        // Inject full list
        countryList.forEach((country) => {
          const option = document.createElement("option");
          option.value = country.code;
          option.textContent = country.name;
          option.setAttribute(
            "data-custom-properties",
            JSON.stringify({ flag: country.flag })
          );
          countrySelect.appendChild(option);
        });

        // Initialize Choices.js
        new Choices(countrySelect, {
          searchPlaceholderValue: "Search country...",
          shouldSort: true,
          itemSelectText: "",
          callbackOnCreateTemplates: function (template) {
            return {
              choice: (classNames, data) => {
                const container = document.createElement("div");
                container.className = `${classNames.item} ${classNames.itemChoice}`;
                container.setAttribute("data-select-text", "");
                container.setAttribute("data-choice", "");
                container.setAttribute("data-id", data.id);
                container.setAttribute("data-value", data.value);
                container.setAttribute("role", "option");
                container.style.display = "flex";
                container.style.alignItems = "center";
                container.style.gap = "10px";
                container.style.padding = "8px 12px";
                container.style.fontSize = "14px";

                const img = document.createElement("img");
                img.width = 18;
                img.height = 14;
                img.style.objectFit = "cover";
                img.style.flexShrink = "0";

                if (data.value === "") {
                  img.src =
                    "https://cdn-icons-png.flaticon.com/512/1045/1045300.png"; // ðŸŒ Earth
                } else if (data.customProperties?.flag) {
                  img.src = data.customProperties.flag;
                }

                const label = document.createElement("span");
                label.textContent = data.label;
                label.style.fontWeight = "500";
                label.style.color = "#333";

                container.appendChild(img);
                container.appendChild(label);
                return container;
              },

              item: (classNames, data) => {
                const container = document.createElement("div");
                container.className = `${classNames.item} ${classNames.itemSelectable}`;
                container.setAttribute("data-item", "");
                container.setAttribute("data-id", data.id);
                container.setAttribute("data-value", data.value);
                container.setAttribute("aria-selected", "true");
                container.style.display = "flex";
                container.style.alignItems = "center";
                container.style.gap = "8px";

                const img = document.createElement("img");
                img.width = 16;
                img.height = 12;
                img.style.objectFit = "cover";
                img.style.flexShrink = "0";

                if (data.value === "") {
                  img.src =
                    "https://cdn-icons-png.flaticon.com/512/1045/1045300.png";
                } else if (data.customProperties?.flag) {
                  img.src = data.customProperties.flag;
                }

                const label = document.createElement("span");
                label.textContent = data.label;
                label.style.fontWeight = "500";
                label.style.color = "#333";

                container.appendChild(img);
                container.appendChild(label);
                return container;
              },
            };
          },
        });
      });
    </script>
  </body>
</html>
